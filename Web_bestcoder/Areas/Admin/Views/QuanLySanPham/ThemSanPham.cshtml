@{
    ViewData["Title"] = "ThemSanPham";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@model Web_bestcoder.Areas.Admin.Models.Products

<main class="app-content">
    <div class="app-title">
        <ul class="app-breadcrumb breadcrumb">
            <li class="breadcrumb-item">Danh sách sản phẩm</li>
            <li class="breadcrumb-item"><a href="#">Thêm sản phẩm</a></li>
        </ul>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="tile">
                <h3 class="tile-title">Tạo mới sản phẩm</h3>
                <div class="tile-body">
                    <div class="row element-button">
                        <div class="col-sm-2">
                            <a class="btn btn-add btn-sm" data-toggle="modal" data-target="#exampleModalCenter">
                                <i class="fas fa-folder-plus"></i> Thêm nhà cung cấp
                            </a>
                        </div>
                        <div class="col-sm-2">
                            <a class="btn btn-add btn-sm" data-toggle="modal" data-target="#adddanhmuc">
                                <i class="fas fa-folder-plus"></i> Thêm danh mục
                            </a>
                        </div>
                        <div class="col-sm-2">
                            <a class="btn btn-add btn-sm" data-toggle="modal" data-target="#addtinhtrang">
                                <i class="fas fa-folder-plus"></i> Thêm tình trạng
                            </a>
                        </div>
                    </div>
                    <form method="post" asp-controller="QuanLySanPham" asp-action="Products" class="row" enctype="multipart/form-data">
                        <div class="form-group col-md-3">
                            <label class="control-label">Mã sản phẩm</label>
                            <input class="form-control" type="number" name="Id" required>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">Tên sản phẩm</label>
                            <input class="form-control" type="text" name="ProductName" required>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">Số lượng</label>
                            <input class="form-control" type="number" name="Quantity" required>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">Tình trạng</label>
                            <select class="form-control" name="Status">
                                <option value="Available">Còn hàng</option>
                                <option value="Out of Stock">Hết hàng</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">Danh mục</label>
                            <select class="form-control" name="Category">
                                @foreach (var category in ViewBag.Categories)
                                {
                                    <option value="@category.Key">@category.Value</option>
                                }
                            </select>
                        </div>

                        <div class="form-group col-md-3">
                            <label class="control-label">Nhà cung cấp</label>
                            <select class="form-control" name="Supplier">
                                @foreach (var supplier in ViewBag.Suppliers)
                                {
                                    <option value="@supplier.Key">@supplier.Value</option>
                                }
                            </select>
                        </div>

                        <div class="form-group col-md-3">
                            <label class="control-label">Giá bán</label>
                            <input class="form-control" type="number" step="0.01" name="SellingPrice" required>
                        </div>
                        <div class="form-group col-md-3">
                            <label class="control-label">Giá vốn</label>
                            <input class="form-control" type="number" step="0.01" name="CostPrice" required>
                        </div>
                        <div class="form-group col-md-12">
                            <label class="control-label">Ảnh sản phẩm</label>
                            <div id="myfileupload">
                                <input type="file" id="uploadfile" name="ImageUpload" onchange="readURL(this);" />
                            </div>
                            <div id="thumbbox">
                                <img height="450" width="400" alt="Thumb image" id="thumbimage" style="display: none" />
                                <a class="removeimg" href="javascript:"></a>
                            </div>
                            <div id="boxchoice">
                                <a href="javascript:" class="Choicefile"><i class="fas fa-cloud-upload-alt"></i> Chọn ảnh</a>
                                <p style="clear:both"></p>
                            </div>
                        </div>
                        <div class="form-group col-md-12">
                            <label class="control-label">Mô tả sản phẩm</label>
                            <textarea class="form-control" name="Description" id="mota"></textarea>
                            <script>CKEDITOR.replace('mota');</script>
                        </div>

                        <button class="btn btn-save" type="submit">Lưu lại</button>
                        <a class="btn btn-cancel" asp-controller="QuanLySanPham" asp-action="Index">Hủy bỏ</a>


                        <script>
                            function previewImage(event) {
                                const imagePreview = document.getElementById('imagePreview');
                                const file = event.target.files[0]; // Lấy tệp đầu tiên từ danh sách tệp

                                if (file) {
                                    const reader = new FileReader();

                                    reader.onload = function (e) {
                                        imagePreview.src = e.target.result; // Gán URL tạm thời cho thẻ img
                                        imagePreview.style.display = 'block'; // Hiển thị thẻ img
                                    }

                                    reader.readAsDataURL(file); // Đọc tệp dưới dạng URL
                                } else {
                                    imagePreview.src = ""; // Nếu không có tệp, xóa src
                                    imagePreview.style.display = 'none'; // Ẩn thẻ img
                                }
                            }
                            document.getElementById('image').addEventListener('change', previewImage);
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Các modal thêm nhà cung cấp, danh mục, tình trạng được giữ nguyên -->

<script type="text/javascript" src="/ckeditor/ckeditor.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>

<script>
    const inpFile = document.getElementById("inpFile");
    const loadFile = document.getElementById("loadFile");

    const previewContainer = document.getElementById("imagePreview");
    const previewImage = previewContainer.querySelector(".image-preview__image");
    const previewDefaultText = previewContainer.querySelector(".image-preview__default-text");
    inpFile.addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            previewDefaultText.style.display = "none";
            previewImage.style.display = "block";
            reader.addEventListener("load", function () {
                previewImage.setAttribute("src", this.result);
            });
            reader.readAsDataURL(file);
        }
    });

</script>
